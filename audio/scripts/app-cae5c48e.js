"use strict";angular.module("app",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ngRoute","gettext","mgcrea.ngStrap","ui.bootstrap.showErrors","validation.match","config","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.buffering"]).config(["$routeProvider","$sceDelegateProvider",function(e,t){e.when("/",{templateUrl:"app/view-base/base.html",controller:"BaseCtrl"}).when("/404",{templateUrl:"app/404/404.html"}).when("/:name*",{templateUrl:"app/view-base/base.html",controller:"BaseCtrl"}).otherwise({redirectTo:"/"}),t.resourceUrlWhitelist(["self","https://www.youtube.com/**"])}]).run(["$location","$rootScope","gettextCatalog","$timeout",function(e,t,a,i){function r(e){t.bodyClass.indexOf(e)>=0&&i(function(){t.bodyClass=t.bodyClass.replace(e,""),t.$apply()},250)}t.$on("$routeChangeSuccess",function(){if("/"===e.path()){var i=e.search();"undefined"!=typeof i.lang&&"fr"===i.lang?(a.setCurrentLanguage("fr"),t.lang="fr"):(t.lang="en",a.setCurrentLanguage("en")),t.bodyClass="home "+t.lang}else{var r=e.path().split("/");r.shift(),t.lang=a.getCurrentLanguage(),t.bodyClass=r[0]+" "+t.lang}}),t.$on("audio.hide",function(){r("audio")})}]),angular.module("app").directive("videoGallery",["$log","$compile","$timeout","gettextCatalog","EmailService","VideoService","$window",function(e,t,a,i,r,n,o){return{restrict:"AE",scope:"=",controller:["$scope",function(e){e.current="newest";var r,l,s,c,d,u,p=function(){s.removeClass("expanded"),c.removeClass("active"),r.remove()},g=function(){r=t('<div class="gallery-expander overlay-row"><div class="container"><div class="video-wrapper"></div></div></div>')(e)},v=function(a,i,n){n&&l.remove(),l=t('<div class="video-share social"><a href="" class="sm-btn btn btn-facebook" data-share-button data-service="facebook" data-url="{{genericUrl}}"><i class="fa fa-facebook"></i></a><a href="" class="sm-btn btn btn-twitter" data-share-button data-service="twitter" data-url="{{genericUrl}}" data-tweet="{{genericTwitter}}"><i class="fa fa-twitter"></i></a><a href="" class="sm-btn btn btn-linkedin" data-share-button data-service="linkedin" data-url="{{genericUrl}}" data-title="{{genericText}}"><i class="fa fa-linkedin"></i></a><a href="" class="sm-btn btn btn-email" ng-click="emailGeneric()"><i class="fa fa-envelope"></i></a></div><video-flag data-video-id="'+i+'"></video-flag><div class="expander-close"><a href="" ng-click="hide()">&times;</div><iframe src="https://www.youtube.com/embed/'+a+'" frameborder="0" allowfullscreen></iframe>')(e),r.children().children().append(l)},m=function(e){a(function(){"parentIFrame"in o&&o.parentIFrame.scrollTo(0,300+u),e&&s.addClass("expanded"),c.addClass("active")},100)};e.hide=function(){s.removeClass("expanded"),c.removeClass("active"),d=null,u=null,a(p,400)},e.killExpander=function(){r&&p(),d=null,u=null},e.changeSort=function(t){e.killExpander(),e.current=t},e.sort={views:{predicate:"-views",title:i.getString("Most Viewed Videos")},likes:{predicate:"-likes",title:i.getString("Most Liked Videos")},newest:{predicate:"-createdAt",title:i.getString("Most Recent Videos")}},this.triggerInlineElement=function(e,t){var a=e.prop("dataset").index;a!==d&&(d=a,r&&t!==u&&p(),t!==u?(u=t,g(),v(e.prop("dataset").videoId,e.prop("dataset").videoRow),s=e.find("div"),c=e.find("div"),s.append(r),m(!0)):(v(e.prop("dataset").videoId,e.prop("dataset").videoRow,!0),c.removeClass("active"),c=e.find("div"),m()))},this.raiseFlag=function(e){n.flagVideo(e)}}],templateUrl:"app/components/video-gallery/videoGallery.html",link:function(e){e.getIframeSrc=function(e){return"https://www.youtube.com/embed/"+e}}}}]).directive("videoThumbnail",function(){return{restrict:"AE",scope:!1,require:"^videoGallery",templateUrl:"app/components/video-gallery/preview.html",link:function(e,t,a,i){e.yPos=t.prop("offsetTop"),e.videoClick=function(){i.triggerInlineElement(t,e.yPos)}}}}).directive("videoFlag",["$log","gettextCatalog",function(e,t){return{restrict:"AE",scope:!0,require:"^videoGallery",templateUrl:"app/gallery/flag-button.html",link:function(a,i,r,n){a.tooltip={title:t.getString("Flag video as inappropriate"),checked:!0},a.flagVideo=function(){e.info("flag video: ",r.videoId),a.tooltip.title=t.getString("Video has been flagged"),n.raiseFlag(r.videoId)}}}}]),angular.module("app").factory("UserService",["$resource","ENV",function(e,t){var a=t.api.endpoint,i=e(a+"/user/:user",{user:"@user"},{update:{method:"PUT"}});return i}]).factory("VideoService",["$resource","ENV","Random","FindWithAttr","$location","$log","$http",function(e,t,a,i,r,n,o){return{getFeaturedVideo:function(e){var t=r.search();if(t.hasOwnProperty("app"))for(var o=decodeURIComponent(t.app),l=o.split("|"),s=0;s<l.length;s++){var c=l[s].split(":");if("v"===c[0]){n.info("videoID",c[1]);var d=i.search(e,"id",Number(c[1]));if(void 0!==d)return n.info("video index",d),d}}return n.info("no video found"),a.index(e)},getVideos:function(){var a=t.api.endpoint,i=e(a+"/video/:video",{user:"@user"});return i},flagVideo:function(e){var a=t.api.endpoint;return o.put(a+"/flag/"+e,{status:"FLAGGED"})}}}]).factory("ModalItemService",function(){var e={};return{setItem:function(t){e=t},getItem:function(){return e}}}).factory("EmailService",["$http","ENV",function(e,t){var a=t.api.endpoint;return{sendChallenge:function(t){return e.post(a+"/challengeEmail",t)},sendGeneric:function(t){return e.post(a+"/genericEmail",t)},sendHelp:function(t){return e.post(a+"/helpEmail",t)}}}]).factory("Random",function(){return{index:function(e){return Math.floor(Math.random()*e.length)}}}).factory("FindWithAttr",function(){return{search:function(e,t,a){for(var i=0;i<e.length;i+=1)if(e[i][t]===a)return i}}}).factory("AppConstants",function(){var e={genericUrl:null};return{setGenericUrl:function(t){e.genericUrl=t},getGenericUrl:function(){return e.genericUrl}}}).factory("CurrentUser",function(){var e={videoID:null,hasFundraiser:!1,userUrl:null};return{getUserVideoID:function(){return e.videoID},getUserHasFundraiser:function(){return e.hasFundraiser},setUserUrl:function(t){e.userUrl=t},getUserUrl:function(){return e.userUrl},updateUser:function(t){e.videoID=t.videoID,e.hasFundraiser=t.hasFundraiser}}}),angular.module("app").directive("idleTimer",["$timeout","$rootScope",function(e,t){return{restrict:"A",scope:{duration:"@duration"},controller:["$scope","$element",function(a,i){function r(){o=e(function(){t.$emit("idleTimer:elapsed")},1e3*a.duration*60)}function n(){e.cancel(o),r()}var o=null;i.bind("click",function(){n()}),t.$on("idleTimer:reset",function(){o?n():r()})}]}}]),angular.module("app").controller("BaseCtrl",["$scope","$rootScope","$log","$location","$templateCache","$modal","ENV","ModalItemService",function(e,t,a,i,r,n,o,l){function s(e){t.bodyClass.indexOf(e)<0&&(t.bodyClass+=" "+e)}var c=i.path(),d=c.split("/");d.shift(),e.childTemplate=""===d[0]?"app/main/main.html":"app/"+d[0]+"/"+d[0]+".html","server"===o.name&&(r.get(e.childTemplate)||i.path("/404"));var u=n({contentTemplate:"app/modals/audio.html",backdrop:"static",show:!1,prefixEvent:"audio"});e.openAudio=function(e){s("audio"),l.setItem({title:e.currentTarget.dataset.title,path:e.currentTarget.dataset.clipSrc}),u.$promise.then(u.show)},e.openModal=function(e){n({title:e.target.dataset.title,contentTemplate:"app/modals/"+e.target.dataset.template+".html",show:!0})}}]),angular.module("app").run(["gettextCatalog",function(e){e.setStrings("fr",{"*This field is required":"* Ce champ est obligatoire.",Close:"Fermer","Confirm Email address":"Confirmation de votre adresse courriel","Email Help":"Email Help [FR]","Email address":"Votre adresse courriel","Error:":"Erreur :","Flag video as inappropriate":"Signaler une vidéo comme inappropriée","Message sent successfully!":"Le message a été envoyé avec succès.","Most Liked":"Les préférées","Most Liked Videos":"Vidéos préférées","Most Recent":"Les plus récentes","Most Recent Videos":"Vidéos les plus récentes","Most Viewed":"Les plus visionnées","Most Viewed Videos":"Vidéos les plus visionnées","Search Filter":"Filtre de recherche","Someone will be in touch with you soon.":"Quelqu’un communiquera bientôt avec vous.","Sort by:":"Trier par : ",Submit:"ENVOYER","There was an error sending the email. Please try again later.":"Une erreur s’est produite lors de l’envoi du courriel. Veuillez réessayer plus tard.","Video has been flagged":"La vidéo a été signalée.","Watch:":"Regarder :","Your Email address":"Votre adresse courriel","Your Message":"Votre message","Your Name":"Votre nom"})}]),angular.module("mgcrea.ngStrap.modal").run(["$templateCache",function(e){e.put("modal/modal-lg.tpl.html",'<div class="modal splash-screen" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header" ng-show="title"><button type="button" class="close" ng-click="$hide()">&times;</button><h4 class="modal-title" ng-bind="title"></h4></div><div class="modal-body" ng-bind="content"></div></div></div></div>')}]),angular.module("app").controller("AudioCtrl",["$scope","$sce","$log","ModalItemService",function(e,t,a,i){var r=i.getItem();e.title=r.title;var n=this;n.API=null,n.onPlayerReady=function(e){n.API=e},n.config={autoPlay:!0,sources:[{src:t.trustAsResourceUrl(r.path),type:"audio/mpeg"}]}}]),angular.module("app").controller("HomeCtrl",["$scope","$log","$rootScope","$timeout","$sce",function(e,t,a,i,r){function n(e){a.bodyClass.indexOf(e)<0&&(a.bodyClass+=" "+e)}var o=this;o.API=null,o.onPlayerReady=function(e){o.API=e},n("audio"),e.playAudio=function(a,r,n){t.info("play",r,a),e.title=n.currentTarget.dataset.title,o.API.stop(),o.config.sources=o.audio[r][a].sources,TweenMax.set(".modal-backdrop",{autoAlpha:1,display:"block"}),i(function(){TweenMax.set(".modal",{autoAlpha:1,delay:.2,display:"block"}),o.API.play()},100)},e.close=function(){o.API.stop(),TweenMax.set(".modal-backdrop",{autoAlpha:0,display:"none"}),TweenMax.set(".modal",{autoAlpha:0,display:"none"})},e.playBtn=function(){TweenMax.to(".modal-backdrop",.5,{autoAlpha:1,display:"block"})},YAML.load("settings.txt",function(a){var i=a;t.info(i),e.imagePath=i.imagePath,e.audioPath=i.audioPath,e.leftItems=i.standard,e.rightItems=i.regional,e.$apply(),o.audio=[[],[]];for(var n=0;n<e.leftItems.items.length;n++)o.audio[0].push({sources:[{src:r.trustAsResourceUrl(e.audioPath+e.leftItems.items[n].file),type:"audio/mpeg"}]}),o.audio[1].push({sources:[{src:r.trustAsResourceUrl(e.audioPath+e.rightItems.items[n].file),type:"audio/mpeg"}]});o.config={autoPlay:!1,sources:o.audio[0][0].sources}}),TweenMax.set(".modal-backdrop",{autoAlpha:0,display:"none"})}]),angular.module("config",[]).constant("ENV",{name:"server",api:{endpoint:"/api"}}),angular.module("app").run(["$templateCache",function(e){e.put("app/404/404.html",'<div class="container"><h1>404. This page does not exist.</h1></div>'),e.put("app/main/main.html",'<div class="clearfix" ng-controller="HomeCtrl as controller"><div class="home"><div class="col-sm-12"><h1 class="text-primary text-center">Languages/Langues</h1><div class="item-index"><div class="col-left language"><div class="intro"><p>{{leftItems.introEnglish}}</p><p>{{leftItems.introFrench}}</p></div><div class="clip" ng-repeat="clip in leftItems.items"><a class="btn btn-primary-gradient btn-lg btn-block" data-title="{{clip.title}}" data-clip-src="{{audioPath}}{{clip.file}}" ng-click="playAudio($index, 0, $event)"><i class="fa fa-play"></i><img ng-src="{{imagePath}}{{clip.thumbnail}}"></a><p class="clearfix description"><span class="title">{{clip.title}}:</span> <span class="text">{{clip.english}}<br>{{clip.french}}</span></p></div></div><div class="col-right language"><div class="intro"><p>{{rightItems.introEnglish}}</p><p>{{rightItems.introFrench}}</p></div><div class="clip" ng-repeat="clip in rightItems.items"><a class="btn btn-primary-gradient btn-lg btn-block" data-title="{{clip.title}}" data-clip-src="{{audioPath}}{{clip.file}}" ng-click="playAudio($index, 1, $event)"><i class="fa fa-play"></i><img ng-src="{{imagePath}}{{clip.thumbnail}}"></a><p class="clearfix description"><span class="title">{{clip.title}}:</span> <span class="text">{{clip.english}}<br>{{clip.french}}</span></p></div></div></div><div class="modal" tabindex="-1" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><div class="audio-player"><a href="" class="btn-close" ng-click="close()">×</a><h3>{{title}}</h3><videogular vg-player-ready="controller.onPlayerReady($API)" vg-auto-play="controller.config.autoPlay"><vg-media vg-src="controller.config.sources" vg-type="audio"></vg-media><vg-controls><vg-play-pause-button></vg-play-pause-button><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display></vg-time-display></vg-controls></videogular></div></div></div></div></div></div></div></div>'),e.put("app/modals/audio.html",'<div ng-controller="AudioCtrl as controller" class="audio-player"><a href="" class="btn-close" ng-click="$hide()">&times;</a><h3>{{title}}</h3><videogular vg-player-ready="controller.onPlayerReady($API)" vg-auto-play="controller.config.autoPlay"><vg-media vg-src="controller.config.sources" vg-type="audio"></vg-media><vg-controls><vg-play-pause-button></vg-play-pause-button><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display></vg-time-display></vg-controls></videogular></div>'),e.put("app/modals/splash.html",'<h2>Watch Videos</h2><p>Lorem ipsum dolor sit amet, qui diceret platonem democritum no. Facer velit in vis, accusamus necessitatibus ei sed. Ad duo accusata conceptam. Tota fabellas democritum no vix. Ut purto posse cum. At modo saepe mea.</p><h2>Regarder Des Vidéos</h2><p>Lorem ipsum dolor sit amet, qui diceret platonem democritum no. Facer velit in vis, accusamus necessitatibus ei sed. Ad duo accusata conceptam. Tota fabellas democritum no vix. Ut purto posse cum. At modo saepe mea.</p><a href="" ng-click="$hide()" class="btn btn-lg btn-primary-gradient">Watch/Regarder</a>'),e.put("app/view-base/base.html",'<div ng-include="childTemplate" class="content"></div>'),e.put("app/components/video-gallery/flag-button.html",'<a href="" ng-click="flagVideo()" class="btn btn-danger btn-flag" data-animation="none" data-placement="right" bs-tooltip="tooltip"><i class="fa fa-flag"></i></a>'),e.put("app/components/video-gallery/preview.html",'<div class="thumbnail-wrapper"><a class="video-link" ng-click="videoClick()"><img ng-src="{{video.thumbnailUrl}}"> <span class="title">{{video.title}}</span></a></div>'),e.put("app/components/video-gallery/videoGallery.html",'<div class="featured-video" ng-if="featuredVideo"><div class="container"><h1><translate>Watch:</translate>&nbsp;{{featuredVideo.title}}</h1></div><div class="overlay-row"><div class="container"><div class="video-wrapper"><div class="video-share social"><a href="" class="sm-btn btn btn-facebook" data-share-button="" data-service="facebook" data-url="{{genericUrl}}"><i class="fa fa-facebook"></i></a> <a href="" class="sm-btn btn btn-twitter" data-share-button="" data-service="twitter" data-url="{{genericUrl}}" data-tweet="{{genericTwitter}}"><i class="fa fa-twitter"></i></a> <a href="" class="sm-btn btn btn-linkedin" data-share-button="" data-service="linkedin" data-url="{{genericUrl}}" data-title="{{genericText}}"><i class="fa fa-linkedin"></i></a> <a href="" class="sm-btn btn btn-email" ng-click="emailGeneric()"><i class="fa fa-envelope"></i></a></div><video-flag data-video-id="{{featuredVideo.id}}"></video-flag><iframe ng-src="{{getIframeSrc(featuredVideo.videoID)}}" frameborder="0" allowfullscreen=""></iframe></div></div></div></div><div class="videos"><div class="container"><div class="row gallery-filters"><div class="col-sm-6"><h1>{{sort[current].title}}:</h1></div><div class="col-sm-6 filter-box"><span class="mini"><translate>Sort by:</translate><br class="fr-br"><a href="" ng-click="changeSort(\'newest\')" ng-class="{active: current==\'newest\'}" translate="">Most Recent</a> | <a href="" ng-click="changeSort(\'views\')" ng-class="{active: current==\'views\'}" translate="">Most Viewed</a> | <a href="" ng-click="changeSort(\'likes\')" ng-class="{active: current==\'likes\'}" translate="">Most Liked</a></span><div class="input-group input-group-lg"><input type="text" ng-model="search.title" ng-change="killExpander()" class="form-control" placeholder="{{\'Search Filter\'|translate}}"> <span class="input-group-addon" id="sizing-addon1"><i class="fa fa-search"></i></span></div></div></div><div class="row video-index"><div class="col-xs-6 col-sm-4 video" ng-repeat="video in filteredVideos = (videoList | filter:search) | orderBy: sort[current].predicate" data-video-thumbnail="" data-video-id="{{video.videoID}}" data-video-row="{{video.id}}" data-index="{{$index}}"></div><div class="col-sm-12" ng-hide="filteredVideos.length"><p class="text-right">Sorry, no videos found with that title!</p></div></div></div></div>')}]);